# 简洁版KGQA框架安装和使用指南

## 环境要求

- Python 3.7+
- Neo4j 4.0+ 数据库

## 安装步骤

### 1. 安装Neo4j数据库

#### 方法1：使用Docker（推荐）

```bash
# 下载并运行Neo4j
docker run \
    --name neo4j-easy-kgqa \
    -p7474:7474 -p7687:7687 \
    -d \
    -v $HOME/neo4j/data:/data \
    -v $HOME/neo4j/logs:/logs \
    -v $HOME/neo4j/import:/var/lib/neo4j/import \
    -v $HOME/neo4j/plugins:/plugins \
    --env NEO4J_AUTH=neo4j/password \
    neo4j:latest
```

#### 方法2：直接安装

```bash
# Ubuntu/Debian
wget -O - https://debian.neo4j.com/neotechnology.gpg.key | sudo apt-key add -
echo 'deb https://debian.neo4j.com stable latest' | sudo tee -a /etc/apt/sources.list.d/neo4j.list
sudo apt-get update
sudo apt-get install neo4j

# MacOS
brew install neo4j

# Windows
# 下载并安装：https://neo4j.com/download/
```

### 2. 启动Neo4j服务

```bash
# 使用Docker
docker start neo4j-easy-kgqa

# 或直接启动服务
sudo systemctl start neo4j

# 验证服务运行
# 浏览器访问：http://localhost:7474
# 默认用户名/密码：neo4j/neo4j（首次登录需要修改为neo4j/password）
```

### 3. 安装Python依赖

```bash
# 安装neo4j驱动
pip install neo4j>=5.0.0

# 或使用requirements文件
pip install -r easy_requirements.txt
```

## 使用指南

### 1. 基础使用示例

```python
from easy_kgqa_framework import EasyKGQA, SimpleEntityRecognizer

# 初始化系统
kgqa = EasyKGQA(
    neo4j_uri="bolt://localhost:7687",
    neo4j_user="neo4j", 
    neo4j_password="password"
)

# 添加知识
kgqa.add_entity("数控机床", "设备", "用于精密加工的自动化机床")
kgqa.add_entity("主轴", "部件", "机床的核心旋转部件")
kgqa.add_relation("数控机床", "包含", "主轴")
kgqa.add_fault_case("数控机床", "主轴不转", "电机故障", "检查电机")

# 实体识别
recognizer = SimpleEntityRecognizer()
entities = recognizer.recognize("数控机床主轴不转了")
print(f"识别实体: {entities}")

# 问答
result = kgqa.answer_question("主轴不转怎么办？")
print(f"回答: {result['answer']}")
```

### 2. 运行完整演示

```bash
python3 easy_demo.py
```

### 3. 自定义配置

```python
# 自定义Neo4j连接
kgqa = EasyKGQA(
    neo4j_uri="bolt://your-server:7687",
    neo4j_user="your-username",
    neo4j_password="your-password"
)

# 添加自定义实体到识别器
recognizer = SimpleEntityRecognizer()
recognizer.add_entity("激光器", "equipment")
recognizer.add_entity("温度过高", "symptom")
```

## 常见问题

### 1. Neo4j连接失败

**错误信息**: `ServiceUnavailable: Couldn't connect to localhost:7687`

**解决方案**:
```bash
# 检查Neo4j服务状态
docker ps | grep neo4j
# 或
sudo systemctl status neo4j

# 重启服务
docker start neo4j-easy-kgqa
# 或
sudo systemctl restart neo4j
```

### 2. 认证失败

**错误信息**: `AuthError: The client is unauthorized`

**解决方案**:
- 确保用户名密码正确（默认：neo4j/password）
- 访问 http://localhost:7474 重置密码

### 3. 端口冲突

**解决方案**:
```bash
# 使用不同端口运行Neo4j
docker run \
    --name neo4j-custom \
    -p7475:7474 -p7688:7687 \
    -d \
    --env NEO4J_AUTH=neo4j/password \
    neo4j:latest

# 更新连接配置
kgqa = EasyKGQA(neo4j_uri="bolt://localhost:7688")
```

## 开发和扩展

### 1. 添加新的实体类型

```python
# 扩展实体识别器
class ExtendedEntityRecognizer(SimpleEntityRecognizer):
    def __init__(self):
        super().__init__()
        # 添加新的实体类型
        self.material_entities = {'钢材', '铝合金', '塑料'}
        self.all_entities.update(self.material_entities)
        self._compile_patterns()
```

### 2. 自定义问答逻辑

```python
class CustomKGQA(EasyKGQA):
    def answer_question(self, question):
        # 调用父类方法
        result = super().answer_question(question)
        
        # 添加自定义逻辑
        if result['confidence'] < 0.5:
            result['answer'] += " (建议联系技术支持)"
        
        return result
```

### 3. 批量导入数据

```python
def import_data_from_csv(kgqa, csv_file):
    import csv
    with open(csv_file, 'r', encoding='utf-8') as f:
        reader = csv.DictReader(f)
        for row in reader:
            kgqa.add_fault_case(
                row['equipment'],
                row['symptom'], 
                row['cause'],
                row['solution']
            )
```

## 性能优化建议

1. **数据库索引**: Neo4j会自动创建约束索引
2. **批量操作**: 大量数据导入时使用事务
3. **查询优化**: 使用LIMIT限制结果数量
4. **内存配置**: 根据数据量调整Neo4j内存设置

## 部署建议

### 开发环境
- 使用Docker运行Neo4j
- 数据存储在本地卷

### 生产环境
- 独立部署Neo4j服务器
- 配置数据备份和恢复
- 使用Neo4j Enterprise版本（如需要）
- 设置适当的安全配置

## 参考资源

- [Neo4j官方文档](https://neo4j.com/docs/)
- [Neo4j Python驱动文档](https://neo4j.com/docs/python-manual/current/)
- [Cypher查询语言](https://neo4j.com/docs/cypher-manual/current/)